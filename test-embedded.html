<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Superset Embedded Dashboard - 部署別フィルタリング検証</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: #f5f5f5;
            padding: 20px;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 24px;
        }
        .info {
            background: #e3f2fd;
            border-left: 4px solid #2196F3;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 4px;
        }
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #ddd;
            padding-bottom: 10px;
        }
        .tab-button {
            padding: 10px 20px;
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 4px 4px 0 0;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s;
        }
        .tab-button:hover {
            background: #f5f5f5;
        }
        .tab-button.active {
            background: #2196F3;
            color: white;
            border-color: #2196F3;
        }
        .iframe-container {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            overflow: hidden;
            height: 800px;
        }
        iframe {
            width: 100%;
            height: 100%;
            border: none;
        }
        .expected-total {
            margin-top: 15px;
            padding: 10px 15px;
            background: #f9f9f9;
            border-radius: 4px;
            font-size: 14px;
        }
        .expected-total strong {
            color: #2196F3;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Superset 5.0 動的フィルタリング検証</h1>
        <div class="info">
            <strong>検証内容:</strong> Dataset Extra JSON + Jinja Template + Guest Token RLS による部署別フィルタリング<br>
            <strong>実装方法:</strong> Dataset Extra JSON に <code>{"where": "department_id = {{ current_user_id()|default(0) }}"}</code> を設定
        </div>

        <div class="tabs">
            <button class="tab-button active" onclick="switchDepartment('sales', '営業部', '¥955,000')">
                営業部 (ID: 101)
            </button>
            <button class="tab-button" onclick="switchDepartment('dev', '開発部', '¥825,000')">
                開発部 (ID: 102)
            </button>
            <button class="tab-button" onclick="switchDepartment('marketing', 'マーケティング部', '¥240,000')">
                マーケティング部 (ID: 103)
            </button>
        </div>

        <div class="iframe-container">
            <iframe id="dashboard-iframe"
                    src="http://localhost:8088/dashboard/12/embedded?guest_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyIjp7InVzZXJuYW1lIjoiXHU1NWI2XHU2OTZkXHU5MGU4XHUzMGU2XHUzMGZjXHUzMGI2XHUzMGZjIiwiZmlyc3RfbmFtZSI6Ikd1ZXN0IiwibGFzdF9uYW1lIjoiVXNlciJ9LCJyZXNvdXJjZXMiOlt7InR5cGUiOiJkYXNoYm9hcmQiLCJpZCI6IjdhYWFiYzAzLTJjNDctNDU0MC04MjMzLWYyMmJiZGIyY2M4MSJ9XSwicmxzIjpbeyJjbGF1c2UiOiJkZXBhcnRtZW50X2lkID0gMTAxIn1dLCJleHAiOjE3NjgxODQ3MTZ9.K2vybhSa0Bl5RnIErUQXLL-_1w3YoCr6XPzwOMTh-sw">
            </iframe>
        </div>

        <div class="expected-total">
            期待される売上合計: <strong id="expected-amount">¥955,000</strong> (<span id="department-name">営業部</span>)
        </div>
    </div>

    <script>
        const dashboardUrls = {
            sales: {
                url: 'http://localhost:8088/dashboard/12/embedded?guest_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyIjp7InVzZXJuYW1lIjoiXHU1NWI2XHU2OTZkXHU5MGU4XHUzMGU2XHUzMGZjXHUzMGI2XHUzMGZjIiwiZmlyc3RfbmFtZSI6Ikd1ZXN0IiwibGFzdF9uYW1lIjoiVXNlciJ9LCJyZXNvdXJjZXMiOlt7InR5cGUiOiJkYXNoYm9hcmQiLCJpZCI6IjdhYWFiYzAzLTJjNDctNDU0MC04MjMzLWYyMmJiZGIyY2M4MSJ9XSwicmxzIjpbeyJjbGF1c2UiOiJkZXBhcnRtZW50X2lkID0gMTAxIn1dLCJleHAiOjE3NjgxODQ3MTZ9.K2vybhSa0Bl5RnIErUQXLL-_1w3YoCr6XPzwOMTh-sw',
                name: '営業部',
                amount: '¥955,000'
            },
            dev: {
                url: 'http://localhost:8088/dashboard/12/embedded?guest_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyIjp7InVzZXJuYW1lIjoiXHU5NThiXHU3NjdhXHU5MGU4XHUzMGU2XHUzMGZjXHUzMGI2XHUzMGZjIiwiZmlyc3RfbmFtZSI6Ikd1ZXN0IiwibGFzdF9uYW1lIjoiVXNlciJ9LCJyZXNvdXJjZXMiOlt7InR5cGUiOiJkYXNoYm9hcmQiLCJpZCI6IjdhYWFiYzAzLTJjNDctNDU0MC04MjMzLWYyMmJiZGIyY2M4MSJ9XSwicmxzIjpbeyJjbGF1c2UiOiJkZXBhcnRtZW50X2lkID0gMTAyIn1dLCJleHAiOjE3NjgxODQ3MTZ9.9QXAoA_LcgOOEwkoL0G-wEQHIwDpPlVdPJoQPSiHKnA',
                name: '開発部',
                amount: '¥825,000'
            },
            marketing: {
                url: 'http://localhost:8088/dashboard/12/embedded?guest_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyIjp7InVzZXJuYW1lIjoiXHUzMGRlXHUzMGZjXHUzMGIxXHUzMGM2XHUzMGEzXHUzMGYzXHUzMGIwXHU5MGU4XHUzMGU2XHUzMGZjXHUzMGI2XHUzMGZjIiwiZmlyc3RfbmFtZSI6Ikd1ZXN0IiwibGFzdF9uYW1lIjoiVXNlciJ9LCJyZXNvdXJjZXMiOlt7InR5cGUiOiJkYXNoYm9hcmQiLCJpZCI6IjdhYWFiYzAzLTJjNDctNDU0MC04MjMzLWYyMmJiZGIyY2M4MSJ9XSwicmxzIjpbeyJjbGF1c2UiOiJkZXBhcnRtZW50X2lkID0gMTAzIn1dLCJleHAiOjE3NjgxODQ3MTZ9.Gq7U-8dcUMWDTl2dIAks_4oZP5SDvwpUH4SJTrrKg-s',
                name: 'マーケティング部',
                amount: '¥240,000'
            }
        };

        function switchDepartment(deptKey, deptName, expectedAmount) {
            // Update iframe src
            const iframe = document.getElementById('dashboard-iframe');
            iframe.src = dashboardUrls[deptKey].url;

            // Update UI
            document.getElementById('department-name').textContent = deptName;
            document.getElementById('expected-amount').textContent = expectedAmount;

            // Update active tab
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
        }
    </script>
</body>
</html>
